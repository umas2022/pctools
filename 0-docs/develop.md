# develop开发记录

### 备忘/待办/恶性bug/下次一定/总之写在最前面
- 记得没事看下future
- tp批处理还没有把所有可选参数都加入前端, 尤其是反向对比的交换参数（暂时通过手动交换输入输出路径来实现）
- 图片压缩的计数器应该只计数图片, 同理视频压缩
- 反向对比删除的时候log目录没有跳过, 之前的log都被删除了
- 手动结束或者暂停程序
- 增加选项：是否要先计数
- 增加选项：是否要预计剩余时间（用数量简单预测/用大小精确预测）
- 大量删除时有几率卡死, 启用了终端有时也会卡住
- 删除后缀时建议增加输入列表, 一次处理多个后缀
- 删除关键字时指定位置（头、尾）, 合并删除前后缀

- 终端switch的图层在log_box上面了

# 2022.11.4
- 添加背景图片
- 添加animate动效
- 设置页重新布局，使用了一些新技术：组件插槽、动态添加class、ref模板引用
- 设置页的两个info动效花费了点时间
- 打包后css中的background-image加载失败，修改了很久打包方法都没能解决；改为手写背景图片，图片重复了10次，不拉到很长看不出来问题

# 2022.11.3
- 新版的前后端都调通了，现在前后端代码都不用修改，只需要在py_script中添加module就行了，真正做到完全动态读取，前后端0开发负担
- 目前只给4个模块进行了升级，其他的等用到了再改

# 2022.11.2
- 前后端结构再优化，目标是前后端完全自动识别script脚本
- 后端增加了自动更新目录的功能

# 2022.10.28
- 图片分拣微调了一下瀑布流宽度, 之前最大化时候宽度稍大, 第五列换行了
- 图片分拣改了背景的z-index, 防止挡到：图片分拣的滚动条被div盖住了不能鼠标选中
- 后端调用终端的if写的不对, 只要有terminal键就调起了终端, 应该是有terminal且为true才, 改了
- 前端图片压缩增加了尺寸上限输入, 还有视频的
- 给后端的manager全部增加了赋值的try
- 所有的中文逗号改成英文逗号了, 不然一直提示挺烦的

# 2022.10.26
- remove三个页面改用v2模板
- samu处理改为先删除差异

# 2022.10.23
- 发现electron启动后端后如果退出前端应用再启动, 后端端口不能被访问, 而且持续被占用
- 手动启动的后端改成新建一个终端
- copy三个页面都改成v2模板了, 增加了点击背后div时log栏收缩, 便于下次操作
- v2模板增加了上中下三个插槽

# 2022.10.21
- 完全备份页改用v2模板

# 2022.10.20
- 实测打包之后不能使用cookie, 修：使用localStorage替代cookie, 好了
- 最近电脑变得非常卡, 禁用了windows的开机启动项, 经测试前端的启动按钮是好用的, 以后每次手动打开后端

# 2022.10.20
- 因为增加的terminal键在某些页面里不存在所以后端报错了, 修

# 2022.10.10
- prototype增加switch, 前后端增加终端模式, 前端识别到终端模式打卡时, 点击开始按钮下方log框不弹出
- 改好了：应该增加终端模式, 目前的视频处理过程没办法截获给前端, 终端模式应该单独线程, 保证其他工作可以并行进行
- 改：samu压缩的log有空看一下, 有几个通病要改一改

# 2022.10.9
- 快捷功能入口提供列表动作链
- v2原型增加了注解按钮, 目前逻辑还有点问题, 下拉框理论上应该每个选项都能提供不同的注解
- 之前改的：发现log根本没有写进文件里, 只有logger.write写进去了, 手动给error和warning加了个write
- 之前改的：反向对比的preset应该先删除文件夹再删除文件, 速度更快


# 2022.10.7
- 三端增加了重命名功能, 目前仅支持增删前缀
- 升级了一版v2的原型页, 现在支持元素混合排列了

# 2022.10.6
- 夜夜夜爬虫, 虽然最终成品半自动的方法非常简单, 采用的直接网页截图的方法, 截下来的画质稍微有点差。
- 网站图片应该是通过一个canvas传递的, 没有找到具体在那个容器里

# 2022.9.29
- home页的快捷入口做好了
- prototype模板增加下拉选择
- 图片压缩时视频被删除了, 删除时没有判断后缀名, 修了, 视频没这个问题, 视频不需要删除, 函数可以直接覆盖

# 2022.9.27
- 使用json低代码形式重写了页面, 用拷贝合并页改了一版prototype模板
- 基本功能全实现了：拷贝（拷贝合并、完全备份、结果检查）、压缩（图片压缩、视频压缩）、删除（删除差异、删除后缀、删除关键字）
- [发现logger好像没有输出到文件里]

# 2022.9.27
- 后端的buffer最后消息定时发送搞定了, 加了一个timer, 现在发送1~1w计时5s应该不会出现消息阻塞
- 前端logbox的ui美化了一下, 尺寸拖动条改为全局鼠标松开时触发停止, 另新增了点击开始按钮时box从最小化状态弹出, 添加了最大/最小化按钮

# 2022.9.23
- 后端使用threading.Timer嵌套实现定时器功能, 用于消息打包, 效果很好, 后端间隔0.01s发送1-999, 使用0.1s打包, 前端可以看到分组发送的消息, 但每组6~8个不等, 说明程序运行占用时间量级在0.1左右
- 不对啊, 用 0.1s -> 1s 还是得不到10个一组的效果, 定时器有问题
- 而且没有设定延时, 一次发送了999个数据, 前端只能显示一次, 尚不清楚是哪里的问题
- 效果好个卵啊, 捕获系统时间戳之后发现输出全都不对, time.sleep和记录的时间不一致。一旦程序里没有手动用time.sleep()延时, 输出结果就奇怪了, 目前观察到80左右的时候中间插入了一个[1-999]的完整数组, 然后后面照常继续显示
- 上面输出两次是因为程序里下面那一行没有注释
- python的计时是确实有问题, 波动非常大, 循环100x0.01s计时在70~140ms之间, 观察到有一次500ms
- 如果删除time.sleep(), 自由运行第一次观察到31ms, 后面都是0, 而且前端能log出来, 但box没有显示；box的显示很随机, 有时候能显示, 有时候不行
- [决定放弃计时器], python的计时很不稳定, 考虑改用定量打包
- 实测10个1组打包效果还可以, 后面要考虑一下程序结束时未被塞满的包怎么发送, 初步想法加一个定时器, buffer发送有两种触发条件：1.buffer已满, 2.到达定时

# 2022.9.21
- 新前端基本有型了, logbox的样式花了比较多的时间
- 后面考虑解决一下消息阻塞的问题, 用ws_test发送1-999实测前端显示的消息和后端大概差了5倍(实测5s:1s), 由此知道后端发一个数字大概用时5ms。后端给消息打个包不知道效果咋样

# 2022.9.20
- 给sp包写了个入口函数
- [发现moviepy有一些类型处理不了, 比如avi和MTS]
- [moviepy在程序目录下会生成一个临时视频, 程序如果中断, 临时视频会留下来, 目标位置会有一个半成品视频, 下次运行时会被检查跳过]

# 2022.9.19
- 加了一个简单的视频压缩函数
- 觉得tp的三层模式不好用, 增加功能时候非常受限, 重新写了sp系列的图片压缩和视频压缩（sp:separat）
- logger增加了一个write函数, 直接写入log文件

# 2022.9.18
- 设置页增加了直接启动后端的功能
- 这功能一般也用不上就是了
- 发现反向对比不能正常运行 -> 发现打包后无法指定后端端口
- 后端端口问题在api_config.js中新增了一套get函数用以动态获取cookie中的port
- 反向对比报错是utf-8编码问题, 默认open函数打不开log文件报错
- 顺便给反向对比的快速json增加了删除空文件夹
- 又发现[瀑布流图片hover按钮显示不正确]
- 还有昨天发现的[鬼畜震动库的test文字是绝对居中的, 不随滚动条滚动]

# 2022.9.9
- 伪瀑布流改为真瀑布流, 删除了初始化加载, 改为直接调用瀑布函数
- img标签改为自定义组件, 组件增加了点击mark功能
- 批量选中并复制功能已经实现, 但复制时偶尔会报错process failed, 是检测函数异步运行导致的, then没有生效, 只能先加100延时了
- 发现后端的终端模式g了, 修好了, 新装系统之后用python调用, 原程序里是python3

# 2022.9.8
- 瀑布流的基本图片展示实现了
- for循环的同步运行没能实现, 使用了then和async代码始终都是异步的, 改用定时器实现功能
- 图片加载的时候非常卡
- [超过index之后报错404, 需要加一个判断]

### 2022.9.4
- python把以前的auto_click重新整理了一下
- electron的调用有点问题, 截图没法成功

### 2022.8.29
- 挪到github了
- 增加了一个点赞效果的test页

### 2022.8.28
- 昨天问题的原因找到了, 因为修改的json在public里面, 属于项目的一部分, serve命令检测文件改动实时刷新了
- 上面发现了问题还没来得及修, 上面和图标没有加载都是打包的问题, 图标放在包外, 用和调用python脚本一样的路径三元表达式, 图标现在打包后可以正确加载了
- 左上角名称的正确修改方法是在index.html里
- 尝试给图片浏览器一个三张图片切换的动画效果, 失败了, 存档在ImgShow_action.vue中, 始终达不到element走马灯的效果

### 2022.8.28
- 昨天和前天好像忘了记了
- 静态资源错误的问题解决了, python单独放在包外
- 左上角应用名称改过来了
- tp批处理拷贝到electron项目里了
- 新增了自动点击前端的一个简单框架
- 留了一个问题[点击json写入按钮后页面被强制刷新了]

### 2022.8.25
- 图片浏览器增加了底边栏, 显示图片基本信息和当前序号
- header增加了隐藏动画
- 前端的tp批处理整合进去了；引入了element图标；增加了ws通信test, 验证后端是否启动
- 增加了js调用python

### 2022.8.24
- 图片浏览器增加了重命名另存功能
- 覆写功能暂时不要了

### 2022.8.23
- electron图片浏览器写了个框架, 因为改了文件名导致打包报错, 重建了一遍项目
- 图片浏览器还没实现剪切功能

### 2022.8.22
- electron hello world

### 2022.8.17
- intf_python 增加了之前tkinter开发搁置的auto_play

### 2022.8.16
- 增加了electron hello world
- 增加了electron + vue 项目 hello world

### 2022.8.8
- tp批处理前后端调通

### 2022.8.7
- 修改apply逻辑使其支持列表输入
- 修改watcher, 计数之后写入logfile

### 2022.7.27
- 增加列表ctrl输入可以顺序处理多个指令
- 增加预置json模板一键调用
- usage中fb参数耦合性太高, counter计数之后的总数应该有更好的传参方法
- logger：顺序处理多个指令时如果中间间隔时间太长, 每一步指令都会以新的时间创建新的log文件, 但log会同时输出到所有文件

### 2022.7.21
- tp框架下增加handler_formatter.webp_to_jpg, 现在华为云可以识别了
- tp框架还引入log_path

### 2022.7.20
- python项目batch弃用, 新建了模板类box_template, 使用finder+handler+watcher组合模式
- 新的模板命名为tp系列, 意味three parts, 代码分为上述三个部分

### 2022.6.27
- log路径为空时后端报错,  with open(logger.raw_logger.file, "a") as log_file读到的file是空 -> 解决：前端没有把正确的target传过去, 另外后端改了logger的调用方法, copy类里没有相应修改

### 2022.6.19
- 增加拷贝方法：反向对比
- 前端copy页结构再次修改, 可选参数全部整合为json文件
- 前端增加反向对比
- 新增tif格式图片直接丢到拷贝列表里了
- 反向对比时log文件夹应该是例外 -> 增加了判断规则
- 前端的target没有dir, 加上了
- copy函数的log文件开头直接用write方法写入了抬头文本, 不再考虑使用临时修改logger级别的方法了

### 2022.6.14
- 图片压缩对bmp报错WARNING: ImgCut - Process failed : 25487 -> 2494, 参考[Remonsan Project]文件夹 - bug没能复现, 不管了
- tools: 注释了py_script的log文件输出：/py_script/components/log.py - > - 工具箱logger封装进class, 支持输入log文件路径
- 前端子组件重组, 增加log文件开关, log文件路径输入
- log功能前后端测试通过

### 2022.6.1
- 修复：重命名类型没有文件夹, 前端选项忘记添加了
- 修复：重命名的log没有返回, 后端写的terminal
- 修复home页ip被跨域, serve时可以通过；使用CORS_ORIGIN_ALLOW_ALL = True允许了所有跨域请求

### 2022.5.29
- 新增：设置页切换开发模式4091/生产模式4090端口
- 新增：拷贝页新增help弹窗
- 新增：输入框加入预设值, 一键填入, 同时修改了json的格式方便检索

### 2022.5.26
- 修复：图片压缩时没有先创建输出目录
- home页增加ip显示

### 2022.5.19
- home页的简易终端增加了cd功能
- just copy 处理大量文件时django报错：... took too long to shut down and was killed. -> 消息阻塞, 增加终端模式
- frontend: showlog: 滚动条自动跳转到最底部时总是会少一行；超过上限100行之后最后一行会显示出来 => 解决：查阅资料发现滚动条位置控制不能在传参时触发, 要在页面渲染结束后调用, 这也解释了为什么在testbutton里log出来的maxpos和watch里的不一样, 明明什么都没。, 增加了onUpdate方法再次触发一次gotoBottom()

### 2022.5.6
- copy_to_one如果输出目录不存在会报错 - 增加了输出路径创建的步骤

### 2022.5.3
- batch重写的rename中的by_number修好了, 是路径拼接错误的问题
- batch重写的rename共4个方法tools都好了
- 重命名和拷贝前后端重写完成

### 2022.5.2
- 前端拷贝页格式和其他两个统一
- 发现前端拷贝全部时后端没有log返回, 测试发现没问题, 等一会就行了, 数据量太大
- 用通用batch模板重写了tools的copy方法, 新box_copy_batch, batch加入了对任意后缀名的支持
- copy类的三个方法后端用类继承的方法重写了, 现在代码非常简洁, 开心
- 显示路径按钮暂时还不能用：解决了, 设置logger模式为frontend时无效是因为每个py里面都用LogRepack()生成了新的logger实例, 需要挨个设置模式才行, 改成只在batch里import一次, 其他文件import batch里面的这一个logger
- 前端log box下部拖动条逻辑优化, 改成一个块了, 结束事件增加绑定鼠标移出, 底部padding设为1000, 底部留有余量时页面高度缩小时滚动条不会自动向上滚动
- log box 文本不换行, 横向显示滚动条
- log box 重复行的值传不进去, 暂时没想到怎么解决, box的刷新是watch props实现的, props值不变没法刷新
- batch增加了一个addpara参数给rename用


### 2022.5.1
- 前端重命名增加了输出路径框, 留空时直接操作原文件, 输入时先把文件拷贝到目标路径再操作
- 后端rename增加了对输出路径的支持, 现在rename前端可以作为一个标准模板
- webp2jpg前后端调通

### 2022.4.29
- python增加头部注释, 包括创建时间, 最后修改时间, 状态, 基本介绍
- 增加general_batch批处理框架, 使用抽象类
- 为batch类增加了uml类图
- 增加box_format基本框架, 聚合batch类
- format完成格式转换.webp->.jpg, 实际上直接改后缀名就可以


### 2022.4.27
- python启动dist有问题, 改用npx了
- 电脑在wsl里配置了端口9001
- nginx setup端口和路径少了两个分号
- wsl环境nginx启动报错： "/var/run/nginx.pid" failed (2: No such file or directory)

### 2022.4.24
- props传参是单向的, 还是得用provide
- 现在的python两页扩展性不好, 考虑应该把所有模式写一个json, 包括ws的api和add_para的组件名也都写在json里
- 重命名写在json里了, 实现了组件的动态加载, 使用了defineAsyncComponent
- 输入框前面的文本和输入框在同一行显示是用了输入框宽度50%来实现的
- 批量重命名整合页面完成, 清空按钮还需修改
- 文件拷贝也仿照做了一个json, 拷贝和重命名两个功能的代码重复太多了
- 翻出来以前的代码作了比对, 修复问题- logbox的滚动条坏了：问题是el-scrollbar的高度不能设置为100%, 应该是具体的数字, 改成冒号表达式了
- 增加未来功能的路由, 先占坑

### 2022.4.23
- 检查统一shellbox格式user_profile和输入确认：apt,nginx,codeserver,node,python,ssh
- 树莓派改源没有成功
- wsl中部署, backend不能启动, 修正了几个文件名和append的路径
- 后端run命令还是路径错误, 新增了os.chdir命令切换目录
- 整合拷贝页面基本功能完成, 附加para还没做, 增加了滚动条, log组件增加padding-bottom, 现在最底部不会显示不到了, 可以无限拉长往下滚动

### 2022.4.22
- 新建onebox项目, 从23m缩小到4m
- 修改一些文件名, init_node路径对应修改
- 前端合并了三个拷贝功能到一页, 内容还没整完


### 2022.4.19
- 启动命令从.bashrc移动到.user_profile
- 统一格式：init_codeserver, init_ssh

### 2022.4.16
- python前端端口改为8088, 后端改为3080防止冲突
- websocket_demo里面没有用config里读的url, 改了

### 2022.4.14
- shellbox在树莓派0里没有完全跑通, 推测是网络问题
- samba增加判断apt是否已经安装, 修复conf文件错误, 增加树莓派版本conf文件
- smb.conf文件里boolean值参数注释写在后面会报错, 要另起一行写注释
- use hash history mode

### 2022.4.12
- shellbox整理, 初始化脚本统一格式

### 2022.4.11
- home页增加简易远程终端
- showlog增加鼠标拖动修改框体尺寸功能


### 2022.4.7 
- 增加空白登录页, 暂不启用路由守卫
- test2改名blank, 放到demo里了

### 2022.4.6
- fix: copy_to_one输出目录不用检查是否存在, 不存在会自动创建


### 2022.4.5
- 修复termux下python init脚本报错问题, 用pip3不用清华源, 注释了两个问题库
- 是pip没更新的问题, 更新完pyqt5不报内部错误了, 但exit提示不是pip的问题, 查资料说pyqt5不支持高版本python, 放弃

### 2022.4.1
- ShowLog偶尔报错解决了, 是v-for时候直接用了item作为key, 有重复元素时key就重复了, 改用index就好
- Rename报错解决了, 改名为RenameBox, 推测应该是rename关键字冲突, 实际调用的不是我写的Rename, 所以报错输入参数不对
- rename增加了文件/文件夹切换选项, 是否打印路径选项
- rename_box代码复用精简
- 前端完成rename2删除括号
- 前端完成rename3添加前缀
- 全部备份、压缩备份报错修复, 总大小为0时除数为0报错

### 2022.3.31
- websocket现在可以在asgi.py里添加多个了, 本质就是数组, 直接相加合并就行
- 项目添加jsconfig.json指定前端文件夹位置, 现在vetur不会莫名报错了
- 重定义log, copy_to_one完成新log写法替换
- copy_to_one前端完成
- backup_all前端完成
- backup_img_cut前端完成
- [rename报错, frontend模式的log也不对]

### 2022.3.30
- 增加全局组件：log显示卡片, 并附demo
- 一键启动前后端脚本
- print目前可以截取, 但log不行
- 拷贝合并页功能基本实现, 目前问题：1.滚动条不能保持在底部 [2.后端代码log改为print]
- 滚动条功能实现了, ref的原理明天要仔细研究一下, [滚动条离最低部总是差一行]
- [重要：后端websocket只能添加一个app, 多个数组报错]

### 2022.3.28
- ubuntu环境一键配置bash脚本

### 2022.3.27
- 前后端增加demo分组


### 2022.3.26
- 增加两个一键启动脚本


### 2022.3.24
- component和usage文件夹移动到py_script文件夹下, 日后报错记得在这里修改
- rename新增方法批量添加前缀
- 后端websocket在app_test中简单实现, postman通信成功

### 2022.3.23
- 前端框架FrameLayout.vue在conmponents里实现, 在App.vue里调用
- copy to one 完成前后端通信

### 2022.3.12
- 新建crawler类
- 新建vue前端文件夹frontend

### 2022.3.6
- 补充readme


### 旧的记录

待办：
    1.删除空文件夹
    2.自动删除空日志
    3.视频压缩考虑纵向视频情况, 宽>长
    3.moviepy不能处理wmv, 改成mp4
    4.视频压缩尝试方案1：修改后缀名, 查到avi>mp4
    5.视频压缩尝试方案2：ffmpeg设定总比特率,https://zhuanlan.zhihu.com/p/407554975


完成：
    2022.1.2：反向对比删除时要把时间戳文件留下来
    2022.1.2：重写img_kleiner, 复用folder_backup代码
    2022.1.2：png尺寸问题解决
    2022.1.2：备份加个时间戳
    2022.1.1：增加文件总大小的统计, 以及不同类型文件计数+大小统计
    2022.1.1：在图片压缩基础上改一版备份所有文件的脚本
    2021.12.30：加一个邮件提醒, 程序结束时候调用
    2021.12.30：反向检查, 删除多余文件
    2021.12.26：moviepy视频尺寸压缩程序完成基本测试, 效果不好
    2021.12.26：logger输出修改, 先显示要处理的文件名, 不然复制大文件时程序看起来好像卡死了一样
    2021.12.25：根据pycharm代码建立git, 改用vscode
    
